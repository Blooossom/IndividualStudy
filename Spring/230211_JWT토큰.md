# JWT 토큰

<aside>
<h2>💡 Authentication(인증) vs Authorization(인가)

</aside>

- Authentication : 로그인, 아이디와 패스워드 등을 통해 특정 서비스에 일정 권한이 주어진 사용자임을 인증을 받는 것
- Authorization : 사용자가 한번 인증을 받은 후 에 그 사용자가 특정 리소스에 액세스할 수 있는 지 여부를 결정하는 프로세스
- 즉 네이버에 로그인으로 인증을 한 후 블로그에 글을 쓰거나 댓글을 다는 등 내 계정으로만 할 수 있는 활동을 시도할 때 네이버가 나의 로그인 여부를 보고 허가 해주는 것

<br>
<aside>
<h2> 💡 왜 인가가 필요한가?

</aside>

1. 로그인은 꽤 무거운 작업임 
2. DB에 저장된 사용자 계정의 해시값 등을 꺼내온 다음 이것들이 사용자의 암호를 복잡한 알고리즘으로 계산한 값과 일치하는 지 확인하는 과정 등을 거쳐야하기 때문
3. 또한 매 요청마다 아이디와 패스워드가 전송되는 것도 보안 상 위험
<br>
<aside>
<h2> 💡 Session vs JWT

</aside>

- 세션과 JWT는 인증보다 ‘인가’에 연관된 기술
<br>
<aside>
<h2> 💡 Session

</aside>

- 전통적으로 많이 사용되어 온 방식으로 서버 기반 인증방법
- 세션 아이디를 사용해서 어떤 사용자가 서버에 로그인 되어있음이 지속되는 상태를 세션이라고 함
- 어떻게 인가를 하는가
    - 사용자가 로그인에 성공하면 세션을 발행
    - 그 세션을 브라우저에도 저장하고 (ex: 크롬에 session id로 쿠키 설정) 서버 메모리에도 저장
    - 경우에 따라 하드디스크와 데이터베이스 등에 저장
    - 인가가 필요한 요청을 보낼 때 서버에 세션값을 같이 보냄
    - 서버는 메모리에 저장된 값과 세션값을 비교해서 맞는 값이 있으면 authorization
- 단점?
    - 세션이 서버에 저장되어 있기 때문에 사용자가 동시 다중 접속할 때 메모리가 부족
    - 서버가 재부팅되어야하는 상황이 오면 서버의 메모리에 저장된 세션이 모두 날아가고 모든 사용자가 로그인이 튕겨서 다시 로그인해야함(DB에 넣어둔 경우, 속도가 느려짐)
    - 확장성면에서 분산된 서버의 경우 세션 유지가 제대로 안되기 때문에 서버 확장이 어려움 ( 불가능하진 않지만 복잡)
<br>
<aside>
<h2> 💡 JWT(JSON Web Token)

</aside>

- 사용자가 로그인을 하면 토큰을 주는데, 이 토큰을 서버가 기억하고 있지 않는다
- 토큰은 세션과는 달리 서버가 아닌 클라이언트에 저장 → 메모리나 스토리지 등을 통해 세션을 관리했던 서버의 부담을 덜 수 있음
- 시간에 따라 바뀌는 어떤 상태값을 갖지 않는 것 → stateless, 반대로 세션은 stateful
- 어떻게 작동하는가
    1. 클라이언트 사용자가 아이디, 패스워드를 통해 웹서비스 인증
    2. 서버에서 서명된(Signed) JWT를 생성하여 클라이언트에 응답으로 돌려줌
    3. 클라이언트가 서버에 데이터를 추가적으로 요구할 때 JWT를 HTTP Header에 첨부
    4. 서버에서 클라이언트로부터 온 JWT를 검증
- JWT는 JSON 데이터를 Base64 URL-safe Encode를 통해 인코딩하여 직렬화한 것이 포함되며 토큰 내부에는 위변조 방지를 위해 개인키를 통한 전자서명도 있음
- 따라서 사용자가 JWT를 서버로 전송하면 서버는 서명을 검증하는 과정을 거치게 되며 검증이 완료되면 요청한 응답을 돌려줌
- 암호화된 3가지 데이터를 이어붙인 형태(aaa.bbb.ccc)로 구성되어 있음
1. 헤더 : 알고리즘(3번 서명값을 만드는데 사용될 알고리즘을 지정함 ex) HS256, type이 들어감(언제나 JWT)
2. 페이로드 : 토큰이 갖는 데이터
3. 서명 : 1번 헤더에 의해 정의된 알고리즘을 통해 암호화된 비밀 값으로 서버만 알고 있음
- 왜 세션을 완전히 대체하지 못하는가?
    - JWT는 세션처럼 모든 사용자들의 상태를 기억하고 있지 않음
    - 따라서 기억하는 대상들의 상태를 언제든 제어할 수 있지 않음
    - 예를 들어 세션을 이용한 경우 한 기기에서만 로그인 가능한 서비스를 만들고 싶을 때 PC에서 로그인하면 핸드폰에서의 세션값은 사용 못하게 하는 등 제어할 수 있음
    - 반면 JWT는 이미 줘버린 토큰을 뺏을 수도 없음
    - 해커에게 토큰을 빼앗겨도 토큰을 무효화할 방법도 없음
    - 해결방법 → 로그인 시 accessToken, refresh 두 개의 토큰을 줌
    - accessToken : 매번 인가를 받을 때 사용하는 토큰(보통 수명이 짧음)
    - refreshToken : accessToken의 수명이 다했을 때 accessToken을 재발행 받기 위한 토큰, 보통 2주 정도 기간이 길게 잡힘
    - 누군가를 로그아웃 시키려면 refreshToken 을 DB에서 지워버리면 되는데 그래도 accessToken의 수명 동안은 바로 차단할 방법은 없음
    
<br>
<aside>
<h2> 💡 참고

</aside>

[JWT 토큰이란??](https://velog.io/@syoung125/JWT-%ED%86%A0%ED%81%B0%EC%9D%B4%EB%9E%80)

[https://pronist.dev/143](https://pronist.dev/143)
